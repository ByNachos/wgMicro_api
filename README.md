# wgMicro API

üîí **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ WireGuard**

WireGuard Configuration Management API - —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π REST API —Å–µ—Ä–≤–∏—Å, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ä–∞–º–∏ WireGuard —á–µ—Ä–µ–∑ HTTP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ WireGuard
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∏—Ä–æ–≤
- **Health Check** —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º UI
- **Clean Architecture** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å Zap
- **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞** —Å multi-platform —Å–±–æ—Ä–∫–æ–π
- **CI/CD** —á–µ—Ä–µ–∑ GitHub Actions

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Go 1.24+**
- **WireGuard tools** (`wg` –∫–æ–º–∞–Ω–¥—ã)
- **Docker** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **Linux** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WireGuard

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd wgMicro_api

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
go run ./cmd/wg-micro-api
```

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t wg-micro-api .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 8080:8080 --cap-add=NET_ADMIN \
  -e SERVER_PRIVATE_KEY="–≤–∞—à_–ø—Ä–∏–≤–∞—Ç–Ω—ã–π_–∫–ª—é—á" \
  wg-micro-api
```

### Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```yaml
version: '3.8'
services:
  wg-micro-api:
    build: .
    ports:
      - "8080:8080"
    cap_add:
      - NET_ADMIN
    environment:
      - APP_ENV=production
      - SERVER_PRIVATE_KEY=${SERVER_PRIVATE_KEY}
      - SERVER_ENDPOINT_HOST=${SERVER_ENDPOINT_HOST}
    volumes:
      - ./wg0.conf:/etc/wireguard/wg0.conf
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `APP_ENV` | –û–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (development/production) | `development` |
| `PORT` | –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |
| `WG_INTERFACE` | –ò–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard | `wg0` |
| `SERVER_PRIVATE_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ WireGuard | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `SERVER_ENDPOINT_HOST` | –ü—É–±–ª–∏—á–Ω—ã–π IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `SERVER_ENDPOINT_PORT` | –ü–æ—Ä—Ç WireGuard —Å–µ—Ä–≤–µ—Ä–∞ | `51820` |

### –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞

```env
APP_ENV=production
PORT=8080
WG_INTERFACE=wg0
SERVER_PRIVATE_KEY=your_server_private_key_here
SERVER_ENDPOINT_HOST=203.0.113.1
SERVER_ENDPOINT_PORT=51820
```

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Health Check

```http
GET /healthz          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
GET /readyz           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏

```http
GET    /configs                           # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
POST   /configs                           # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
GET    /configs/{publicKey}               # –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É
PUT    /configs/{publicKey}/allowed-ips   # –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ IP
DELETE /configs/{publicKey}               # –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
POST   /configs/client-file               # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π .conf —Ñ–∞–π–ª
POST   /configs/{publicKey}/rotate        # –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –ø–∏—Ä–∞
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```http
GET /swagger/index.html    # Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∏—Ä–∞

```bash
curl -X POST http://localhost:8080/configs \
  -H "Content-Type: application/json" \
  -d '{
    "allowedIPs": ["10.0.0.2/32"],
    "presharedKey": "",
    "persistentKeepalive": 25
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

```bash
curl http://localhost:8080/configs
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
curl -X POST http://localhost:8080/configs/client-file \
  -H "Content-Type: application/json" \
  -d '{
    "peerPublicKey": "peer_public_key_here",
    "clientPrivateKey": "client_private_key_here"
  }'
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **Clean Architecture**:

```
internal/
‚îú‚îÄ‚îÄ domain/      # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ service/     # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (use cases)
‚îú‚îÄ‚îÄ repository/  # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (WireGuard)
‚îú‚îÄ‚îÄ handler/     # HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π)
‚îú‚îÄ‚îÄ server/      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ config/      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îî‚îÄ‚îÄ logger/      # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã**
- **Dependency Injection**
- **Interface Segregation**
- **Repository Pattern**
- **Clean Architecture**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
go test ./...

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test -cover ./...

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
go test ./internal/server -tags=integration

# –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
go test ./internal/handler
go test ./internal/service
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

- **Unit —Ç–µ—Å—Ç—ã**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Integration —Ç–µ—Å—Ç—ã**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP API
- **Mock –æ–±—ä–µ–∫—Ç—ã**: –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Test Coverage**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### GitHub Actions CI/CD

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ GitHub Actions:

- **Multi-platform —Å–±–æ—Ä–∫–∞** (AMD64, ARM64)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** –≤ Docker Hub
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

### Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
2. **–û–±–µ—Å–ø–µ—á—å—Ç–µ NET_ADMIN –ø—Ä–∞–≤–∞** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** health check —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –≤ production
5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```bash
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è API
swag init -g cmd/wg-micro-api/main.go -o docs
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
go fmt ./...

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
go vet ./...

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy

# –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
go build -o bin/wg-micro-api ./cmd/wg-micro-api
```

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–µprivileged –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π
- **CORS –∑–∞—â–∏—Ç–∞** –¥–ª—è web –∑–∞–ø—Ä–æ—Å–æ–≤
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–µ–∑ sensitive –¥–∞–Ω–Ω—ã—Ö
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `/healthz` - Liveness probe (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- `/readyz` - Readiness probe (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
